---
lang: zh-CN
title: 2.4  文件
shortTitle: 2.4  文件
date: 2023-11-22
description: python 对文件的使用方法
index: true
icon: python
category:
  - python
  - 语法基础
tag:
  - 阅读记录
timeline: true
isOriginal: true
star: false
article: true
---

文件读取是 Python 文件中一个基础且常见的操作，这里不过多赘述。

## 2.4.1 文件打开模式描述串

常见文件打开模式描述串如下所示：
|模式|说明|
|-|-|
|r|按读模式打开，是默认方式，可以不写|
|w|按写模式打开，文件不存在时创建新文件，存在时清除已有内容|
|x|排他性地创建文件，如果所指文件已存在报 osError 错误|
|a|按附加方式打开，在已有内容之后写。文件不存在时创建新文件|
|+|更新文件，不单独出现。r+表示保留原文件内容，从头开始读写:w+表示清除E有内容:x+与w+类似，但排他性地创建文件:a+与 w+类似，但不清除已有内容从最后开始读写|
|rb|按二进制读模式打开，是默认方式，可以不写|
|wb|按二进制写模式打开，文件不存在时创建新文件，存在时清除已有内容|
|ab|按二进制附加方式打开，在已有内容之后写。文件不存在时创建新文件|


## 2.4.2 文件输入输出相关函数

常见文件输入输出函数如下：
|函数|说明|
|-|:-|
|f.read(n)|要求从文件读入全部字符，若 `n` 有赋值则读取前 `n` 个字符，字符不足时读完剩下内容|
|f.readline(n)|要求从文件的光标处读入一行字符，若 `n` 有赋值则读取前 `n` 个字符，字符不足时读完剩下内容|
|f.tell()|返回一个数值，表示文件的当时操作位置。|
|f.seek(offset,whence)|设置当前位置。<br/><br/>第二个参数默认时，`offset` 可以是 0 或 `SEEK SET` (两者效果相同)，或以前由 `tell()` 得到的值，把当前位置设到以文件头为基点的 `offset` 处(其他值的效果无定义)。<br/><br/>第二个参数可以是：<br/>1. `SEEK CUR`或 `1`，这时 `offset` 只能是 `0`，相当于空操作;<br/>2.  `SEEK END` 或 `2`，这时 `offset` 只能是 `0`，要求把操作位置设到文件尾。|

Python 把文本读文件对象也看作可迭代对象，因此该过程也可以看作一种生成式读取方法。

## 2.4.3 常见 os 操作
|函数|功能|
|-|-|
|mkdir(path)|创建由 path 描述的目录。path 是简单名时在当前目录下创建目录:对一般文件路径字符串，要求指定位置已存在。|
|mkdirs(path)|创建任意深层的一系列目录，缺少中间目录时函数将依次创建。|
|chdir(path)|将当前目录转到 path 指定的目录。|
|chdir(path)|将当前目录转到 path 指定的目录。|
|listdir(path)|返回一个表，其中包含 path 说明的目录里的所有文件和目录名，用一组字符串表示。默认路径.表示当前目录。|
|remove(path)|删除 path 指定的文件。|
|rmdir(path)|删除 path 指定的目录。|
|scandir(path)|用于遍历一个目录下的所有目录和文件，该函数返回一个选代器，通过它得到的每个项是一个文件或目录。|
|path.isfile(file_path)|检查当前路径目标是否是文件|

## 2.4.4 文件的缓存与冲刷

文本输入输出默认采用**缓冲方式**，open 打开文件时建立一个**缓冲存储区**（缓存）作为程序和文件之间的中介。输入操作从缓冲区读取，缓冲区内容用完时自动从文件搬一批数据到缓冲区;程序产生的输出存入缓冲区，缓冲区装满时自动写入文件。

缓冲式输入输出可以缓解内外存速度和使用方式的差异，提高程序性能。

调用` close `关闭文件时，解释器将把当时还在缓冲区里的数据写入文件。如果程序正常结束，解释器也会关闭当时仍处于打开状态的所有文件，保证输出都实际写入文件。如果程序非正常结束，当时未关闭的文件的内容完整性就没有保证了。这里也提供了**冲刷**操作，调用` f.flush() `把当时` f `的缓冲区里的数据写入文件。打开文件时可以通过` open `的参数指定缓冲方式，简单情况下采用默认的常规缓冲方式。

> Python 文档标准函数 open 的使用形式是:
` open(file，mode='r', buffering=-1, encoding=None, errors=None,newline=None, closefd=True, opener=None) `
除文件名参数` file `外，其他参数都有默认值：` buffering `要求一个整数指定缓冲策略，` -1 `表示采用默认策略；` encoding `说明编码规则，只用于正文模式；` errors `说明编出错时的处理，比较复杂，可用` "ignore" `要求忽略错误，但在未能正确解码时可能得到乱码；` newline `说明把什么字符看作换行，` None `表示交由 Python 解释器处，通常都能做好。最后两个参数涉及一些细节，请查看标准库手册。

:::info
按二进制模式打开文件，就应按二进制文件使用。后面会介绍的实现持久性的` pockle `包在工作中使用二进制文件，有关操作由其函数处理。自己操作二进制文件的技术细节较多。

常规需要大都可以借助` pickle `等程序包完成。
:::